pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

-- squares
-- by luisfl.me
-- compiled: 24/08/20 13:06:23

-- 1_init.lua

function _init()
    -- buttons
    left = 0; right = 1; up = 2; down = 3
    x = 4; c = 5

    mode = "game"

    -- number of squares = size * size (preferably a divisor of 128)
    size = 4

    initialsquares = initsquares()
    randomsquares = randomizesquares(initialsquares)
    squares = randomsquares

    -- empty/black square
    emptysquare = {}
    emptysquare.row = size
    emptysquare.column = size

    -- square movement animation
    squareanimation = {}
    squareanimation.running = false
    squareanimation.row = -1
    squareanimation.column = -1
    squareanimation.nextx = -1
    squareanimation.nexty = -1
end

function initsquares()
    local squares = {}
    for j = 1, size do
        local row = {}
        for i = 1, size do
            local square = {}
            square.id = i + 4 * (j - 1)
            square.px = 32 * (i - 1)
            square.py = 32 * (j - 1)
            add(row, square)
        end
        add(squares, row)
    end
    return squares
end

function randomizesquares(squares)
    local randomsquares = {}
    local randomcoords = {}

    for i = 1, size do
        for j = 1, size do
            if i ~= size or j ~= size then
                add(randomcoords, {i, j})
            end
        end
    end

    for i = 1, #squares do
        randomsquares[i] = {}
        for j = 1, #squares[i] do
            if #randomcoords > 0 then
                local randomcoord = randomcoords[flr(rnd(#randomcoords)) + 1]
                local row = randomcoord[1]; local column = randomcoord[2]
                add(randomsquares[i], squares[row][column])
                del(randomcoords, randomcoord)
            end
        end
    end

    return randomsquares
end

-- 2_update.lua

function _update60()
    if mode == "game" then updategame() end
end

function updategame()

    local dx = 0; local dy = 0; local buttonpress = false

    -- show image for reference
    if btn(x) or btn(c) then showimage = true
    else showimage = false end
    if showimage then squares = initialsquares
    else squares = randomsquares end

    -- check if any directional button is pressed (only in this case the empty square can move)
    if btnp(left) or btnp(right) or btnp(up) or btnp(down) then buttonpress = true end

    -- determine where the empty square should go
    if btnp(left) then dx = 1
    elseif btnp(right) then dx = -1
    elseif btnp(up) then dy = 1
    elseif btnp(down) then dy = -1
    end

    -- is such movement possible?
    if buttonpress and not showimage then
        if emptysquare.row + dx < 1 or emptysquare.row + dx > size 
        or emptysquare.column + dy < 1 or emptysquare.column + dy > size then
            -- error sound
        else moveemptysquare(dx, dy) end
    end

    -- animate square if enabled
    if squareanimation.running then
        -- update moving square
    end

end

-- todo: enable squareanimation here
function moveemptysquare(dx, dy)
    local oldrow = emptysquare.row
    local oldcolumn = emptysquare.column
    local newrow = emptysquare.row + dx
    local newcolumn = emptysquare.column + dy

    -- move non-empty square to be replaced
    squares[oldcolumn][oldrow] = squares[newcolumn][newrow]

    -- change empty square
    emptysquare.row = newrow
    emptysquare.column = newcolumn
end


-- 4_draw.lua

function _draw()
    cls(0)
    drawsquares()
    if not showimage then drawborders() end
end

function drawsquares()
    for j = 1, #squares do
        for i = 1, #squares[j] do
            if i ~= emptysquare.row or j ~= emptysquare.column or showimage then
                sspr(squares[j][i].px, squares[j][i].py, 128/size, 128/size, 32*(i-1), 32*(j-1))
            end
        end
    end
end

function drawborders()
    for i = 1, 3 do
        rectfill(32*i, 0, 32*i, 128, 0)
        rectfill(0, 32*i, 128, 32*i, 0)
    end
end

__gfx__
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666cccccccccccccccccc
666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666ccccccccccccccccc
6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666ccccccccccccc
6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666cccccccccc
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666cccccc
666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666c6ccc
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
666666666666666666666666666666666666666666666666666666666666666c6666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
666666666666666666666666666666666666666666666666666666666666666615dd6c6666666666666666666366666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666695555555555555555556676666c66666666666666666666666666666666666666
6f66666666f666666666666666666666666666666666666666666666666666691555555555555555555555511166666666666666666666c56666666666666666
6f66ff6fff6ffffffffffff66666666ff6666666666666666666666666666664e555555555555555555555555566666666666666666666556666666666666666
ffffffffff7ffffffffffffffffff6fffffffffffff6666666666666666666ffe55555555555555555555555557f666666666666666667d56666666666666f66
ffffffffffffffffffffffffffffffffffffffffffffffffffffff66666666dfe555555555555555555555555516666f666666666ffffccd6ffff6fffff77761
f777777ffffffffffffffffffffffffffffffff7777777ffffffff666666ffe4f91555555555555555555555555fffffffffffffffff766dffffffffffff7651
77777777777777fffffffffffffffffffffffffffffffffffffffffffff77fee945555555555555555555555555d7f77fff7777fff77dcc335fff7f77fd55515
77777777777777ffffffffffffffffffffffffff7ffffffffffffff777f777e69455555555d55555555555d55d51f777fffffffff77ddccd33d7ff7c7d57d155
77777777777777ffffffffffffffffffffffffffffffff7777777777777776e6e4955555555d5555555d9a5dd55dd3f77777777ff7c55cd535d6c67ddd11dd59
7fff7fff777777ffffffffffffffffffffffffff77777777777777777f77feefe495555555555555555d9955d5dd53d777777fff7fc155d5513dd3fd5d945dd4
77777777777fffffffffffffffffffffffffff77777777777ffff777777774e999e65555555555555559999555dd555d7777777773d599550955dd5655155995
7777f7777777ffffffffffffffffffffffff76ff7f7ffffff777f7777777de44446e5555555d55d555599515d5955555677775d63d53539355d3935d5d5554d5
ffff777777ffffffffffffffffffffffff766d6f65fffffff77777777f7764fffff755555555d5d55593f55d55965556695779553555395151555d1dd55d5d55
ffff777777fffffffffffffffffffffff9553555777677777777777ff5ddf777f7f795d95993d55dddd951999335dfc639399599d559d1535d5dd9d555515595
777777fffffff65f57f757cffffffffffdd3d55d5d95d3653555777fd555777f777779d55d955dd5d5d9559dd955359593339955531d95553555ddd544dd9d55
fffffffffffff65dd5c5555fffffffff6ddd55555d3d3d93ddd5f77d55dd77777777f5d55dd5551111999993f99d3d33939995115d5d555555112242e5d555d5
77777777fff355d55dd5555ffffffff53d555d555553d5d5555d7f7759d4777f7477f95dd55d556c99d9953d533d539d55599595d3911d115d59d44d4f9dd955
f7777777fffdd5d535d555557fffff75551955ddd15d5d3d555577f7dd55777f27fd5d6995365d65d9d5d5355d555335599d59515d5d951d5553554d933d9d15
fffffff7ff6655d5ddd55d5d56fffffdd1d55d15555535dd5d5577669d54fa2f66f7d5935f5d5555935d995555511551513d45355d935595155339d555535455
ffffff7fffd5d5515559555d59d5dff75515d55555519dd595515499d54e959f27f7d95d5555555599593555d315d5155d999955511955455d353dddd933d5d5
fffff77f76d5d55555d51dd455955dddd55555555555dddd155546fd5546959f27f7d59d55505155395dd55d555554555993951551595351d993dd95d99dd999
ffffff7fdf5555555555dd9d155d3dd9dd3559d5555dd3dd5555e9fddd4ffdedd7f959d559d5555599d535559d55555553d95d555d51d55e9199555999535595
ffff6c666dd555551653d5d5d9dddddd55d555555555ddd555de4d4d5597ed55dffad75d3dd55555599dd59535555555993355554995555995dd555ddd935353
df56cd33666666d1175dddddddddddd555d511d1515ddd5555555dd59999e44444494d5555d555199955935555155555d554d555d19d15599559d149d33339cd
555d97c6f777ffc6655ddddd65dddd335155155155555d555555555555554ed4d444ed9545d5555355f4d34d5dd555555535559d1351155e41111dd9ddd5324f
6d5f6f9f6dfd6d3d5d5d55d55555d49d555d15555554995556699999669dd0d1d9df555d5495196a5d3953dd135555559395599111ddd444999ddd555d356014
9d5f6f6f65f9fdc999ffa999f9f9ff95555d5555555dddd96999996699d554d2155955d5555d545d9995d4dd5915d55551559d5411119e9979999dd933532001
d55d5fdd9d9d95c599ffa9f99999996dd55555555d56993ae9942f4ee9555d25211955115e555139d55d55dd5955555515d410955194e999999999d5dd521000
12141555555541de9ffff9f99999f9a3d55d555555ddd559555949eddddd1ddd3dd95155c44655d9935d99553545444551dd155514d9999e99999e9dd3900000
551e11555dd5555e59a9e4999f94ff45155555551555353de594e999933d3d33333c55de424ee599d9333d5551d14d1f9ddf9595145e999ee952445951200000
dddddddddddddd55599d999d9994d555d55995555ddd599559efffafe9dddddddcc35549994492459699545511524e19d5dde5dd110e9f944e190e535d000000
d5dddddddddddd555d5d555ddd49dd111559555555525255d4ffae99de94eddedd99511c9224f241555115555155425959d651d49159ef99e9402e4494000000
9999aff4a9af9e411111111555d9333355d335511151d55d5ff4dddddd59d99d99d6d5555544142e51151111111511115e555551115555112551111520000028
99999f9e999a9edddddded555dddd555d5555551555d53d59d9d5dddd9ededd9599ddd5ddddd5400455111111111111120415555555555555551111c00000008
99e9999ee9979ddddddddd511115555355555551dd5d35dd9deeeed2444d44444444001115511200e21511111111155400041555555555555551115202000088
9999999e99999ddddddddd5dd355d55555555599999499faff99999999f99f999999ddd55ddde200225151111111150000004151555555551111156000000822
ffff9f9999999d4dd155dd5dd55d55555155d99dd3d59999999999e999ee99999992955ddd541000024111111511150000000e11111115551551512251002822
49eff4fe999f9dd111441d5545555555555499d95d55997799e9e49944994e4d444105dd5d5400002244111114555200000000e208000000000111115120822d
4fe99499999695d44495d415545d555555dd939999dd49e9942555555555555555401dd555422002222411154221555500008001822220000000000000008829
9fe9f299ef9994e4dd3dddd5524555555559ddd9ddd5499f222425555544555551110000020000222228411e00041155110820208242200000000000015082dd
9999999ef9999ef45dd45d5514d1521515544d55d59dee6222222215542855115510022442020222222894400000415511088020282220200000001555502424
999e949999f994f999999999ff9999999ffffa9add5dd999222202220280255511512224200022822228422200002411100220242442200000155555ddd02399
e9ee94949ed994f999ffddffff9ffffffffff9945dd554777e2252244282e415111122222200d2822222224200044040000220242422800d5d555dddd6d04d52
4e4e99949ed994fe9f9911f99699ff9ff9fffa4dd4d5de999292522428884400000022484222422222282144482242248802202444445d55dddddddd150023d4
444444eee4e4eeee9ee4414569999eeee9ee9e99955d554992e242248e94e44e22222298220118244222244448442144420440242444224ee9699e9d20004533
ddd395d9ed5edde99d9dd5d9939993d9999999d9d55d59922222e2222224eee9482224682e00082222222444424424442402204224224222224882222820da3d
ddd3333393ddd9d39dd549ddddddd39f39999f95145d9952222202222224ee99422222f84200082222222244424949444402202122224444424224444220d955
9d559d33d5d953d59dd99955d599d99d99a999935999994222220222282e9449482222f84242082244441144422ee2299e08204122224e444442244444223555
555555d44deddd44f4ee54d4ddd99d3999f39959999f9d42140202222de42444482224424020024224e255444884224e9e08404122224d4444d22444e620935d
e49e9e9e9e9999ddee554eeee9ee4e4eed9999ddd999d54110024410155e9424402024204202884421d2114444044244e48242218822494224422444e6215d54
44499999977c7fe555dddee999e99f99eeedeeeeddd4992dd224228410e9ee2412dddddd22048844224219d24204442444802221282444422222244224223354
444e444444e99931c5555554499999999ee9ddeed9d5491d1ddd59101191442e4d9dd5d22005d99eee4e9920424229eeeddd4444222444224242224424299945
444ee49ee9fff655c55555d4eeeeeee4444444245d3ded9e1d533994999934d9f9999ed4d500042212800dde9999d412110100000000444442422444244d955d
444444e4ee9e6fd54455544ee9499e99e444dd4dddd35555f766f7655593d999d3f9999ef41012424e99249ee2025000000022802202442442424224555535d3
4444d4d44edde95d9544444eeeeee999e4ddded5dddd4d561c3dd551d555d4545593f9544500d4ee9499999f9f4442440000028242284222e224244244210053
444444444e4495d594444444dedeeeeeed9ddddd94ddeedfdcc3dddd5399d9353559995d5dd1114dee9f99fff9eee49e4449ed44444424422222222422244802
ee4e44e4e94ee4959eed44eee4ddeee9999999dddddddd4dd444444555e554593393935d52114eee14944e9e9999fed9edd9e469999999ff9e4444442244ee28
eeeee494e949e4949eee44999ed999e9999999d5555d9d454124542151d444444d9999d94d50544444e94249e94d055d950999de699996666996ff699f9e99e4
ee999494ef49ee9d9eee449999e999e9999999e5444d9d411424544244554424444444dd4441414ee499944e944d5dddd4d4ee4e9e69d996fe9ed9fff6ede999
ee9994949aeaee949eed449e94ee99eeeee999e545559ee2422414422ede444442441111d1111144444e9e99994404414455d7ff7ffd4e99996666f69f999f69
ee999e949fefeee4e4e444e9ee4ee9ee4eee944555559e9fe44444442d4e4e4442555441951212244444444999ee9d959dd0ffff7f77776d51d45d9d99999dd9
999ee99ea7ef9ee4444444eee9e9e9994ee4d55dd555ee99e4444442244e4e4e42444441e4141222222222eee944e45ddd456f7f6d96c64d454ddd51defd99d9
9ef9e99e77979eeddedd4999e99e6f9c3dd49d445d5dee99e494494424444444422244e244444444442222424444424444677fff67df77fd95d549d1d5dd9d9d
9eeee999f7979e699d96dd9999969655ddd6996ddd69999699d2dd9e4dd4444442444492444442444dd44412402221422115d96fff66cd51d455111100015555
9e94999977e77ee99d999d666f66f955555555966dc6966f6669d69f95eee9444244449244442244444424444444242011ffff66666c33dddd9d4dd011d55444
41454e9e6797fe99966666666666655d55dc15d6c6f6fff666666fffdcf699ffe9e424e442112224444244424454445111665d6f95ddddde44edd9e01049d4d5
94544e499a977f9666699666666666ddd559555336d666f6f6f66ff6666f9969999444e442111222244224222224441111d596666d55111eeeeeedd5d1dddd1d
999915199f777e999696966666666566555455555d9696f6f66ff66f6f996f9e69ee24444111422222422222222444445177655d999d55d42444e9d12954ddd5
6699d4d19f777e996d66996666666966d5695535d6666ff66666fffff66f66f96f99d4444442222222422222222444444456ff7f63d555512222244041d54e4d
699e5d6d9997fed99d669d69666666666c6c69d5c6cd66666666f66f6666f6699969444e54511222224244222224424444446666ffcf66dd4222222111211021
6966d69999e9f55d55dd999666666dd99616d655d666ff6f666f6666666f69999999d5499ddd022222222222222444444422f66666c6c4222454110100111011
9969d95555595555c55d99666655555d55d6d655c566696666666fff6666f9999969dd4d41521024e42224228022222444229999dddeee422222224224424222
6169195555155551555596666655556654dccdc5d5c666ff666666666c666699999964d5954150424882dd42222222244424ed999de44e422242224124222222
15f65656155555555551dd55d665dd9d51dc6cdd55666f6f9fc6f666666ff9e99ff69d495619d42dd2e9e222e99d22244222e02422424e422292222244212020
669659995d55555555596dd9d1556966969696cdc3c66f666cff66f6f6f66f6999f9d55455d5d11496652ee9e4dd6dd22424ee442222242242e422244e421442
6999d666555155dd59dd69996695966656396d6556cc666666f6f6f6666666f99696dd66f401412042e0222e40994cd4424422ddddd42e222244222249422222
6969d99691515d1ddd696d966666666655999d666d56c666f66667f66c6ff66969f9d5dd961166c9655244942e969669e42284d625d24e92224222224e222224
5555d669d115115699d96d6666f6f66969539c666d13f66666c66f666666f6699f969659d6c1dd5220822d9699f6666d5e19d26f2499d94222d222222e244422
5d55599995511155d6d66966669566d5c96cdd05cf3fdff669666ff66f6669f9f6696566d4cc6cdd24222d54969d5d19d63d249249d00244e992244444224144
5155559669555515555d66999d955cd555dd33cdcfc6c66f66f36f6666666f99ff6f64545dc66c42d2d21526ed51d915036666665964c2492224e22224244414
355ddd666555dd115cc6966f95556d5555515136dc6c66666f6667f66f666f9f96f9d6d56d6c61dc996504d404f6c6d425d306d29cc66ddc6966942224444414
5dd9dc6691555111111d9c6d1515d5115d6dc6d6636d69d6667dff666666669f66f666d6d566c6d569666d56c996566d05669dd1566669666666524224245441
1555d66615555511155dccd5455d15144d6cc6dfd56666666666f6f6c6c66699996669dd0ccd16636f9225546fcdd6cf0ddc6cd69066d1dcd0d09d242d514441
159dd6d596d55511155cc6d55556cd546cdc6666c6366f966cccc66666f66f9699996d161c6ddd5c6666c30d69dc67ddfcccd666759621566d9dd24424215544
53696d5156551111d55ccc5dd651d55d5ddccd6cc6d6d6f666666f66c66666999699fde69c66033d36d566d6dd6656fcddfc066dd6d9515fd22dc42144215544
666d696dd6511551dcd55dd1c591d455155dcccddfcc666c66ccc6f6fc66d5e49f96482e6c3cdcc6d4699d0d6666d366556f6c66666c56d46dcfd94222225554
6cc666696d651111dc6d5d16dcd11411d6d1ccd66ddccccccd6666666666d4484964882e3cccc6d360ddfcd6c07cc6f606666666d6c3d6d6c596d02014424514
9d6d53555d5d1193c66355515151d156c661cdddc666fcc6636cc66fcd2242888ee88224dd61ddfdd6c67c6c5f6dc676c66c6d5f63cff136ccc6cd5014221454
5555555551d9113d55555c11555d51115c66ddcc3dc6ddcd66cd66c6c288822284e888888dc6d6d66dc1cd6dc7fc176cd66ccfc6c566cd6cd6d6664442014144
63dcc5ddd55599616566cc36156155555dd66dccccc3cd6666dc66c6d2888822288888882dd6c666cd6c5d6d6dc666c6666d3fdd66ccfc56c6d66d3631225144
566665666d3669361156c335d51115655dcdcdcccddc33c3d6cdc5d6d48888222888882253cc6ccddc6cdd5665c6536667d6c66dcdc6dcf6dc6d6d5431100115
15555566663d69f36c69d5965c1555515555dc3cd6cdcccc66c666dc6d288888888882215cc9ddc66dc6dcdccd666cc66636c6cc666c5c627d6dc6c00140dd11
fcd635339936915651611d5dd50555dd6511d66c3ccdd5536cd3c3ccc6d48888888882515cd22dd66dccc3c3cd3fc6cc6c6cc6c6ccccd661d66dd661110dc00d
5dd6953335c965d95f65113511165dcc555dcdcdddcd3dd3536355533ccd4808822224d55d52452444dc6d6cddcddc66ccc6c65666cccc6dccdc6dc6c5dd2466
dd63d553353f63d511555111113513c615156d1dc31195d55d555555d36cd420822225d5d5d45588885cc3cc6dc6dc6cc6636c66d6ccccddcd63c61dcc436145
5ddd55333333551111111111105153cfd66c5d5651551155153555555d66d1112221155553d5528888dc6c3ccc5cc1cd666c66665cdcccccccc3dccdcd2d35dd
3555555533333135335155511351d6d5556cc351cd5c1d63353d355555c3cc3551111d5553dd528888433c5ccddcd6336cccc66cc6cdc6cdcd63665dcc565dcd
331111155333353333515111035155515553d5556636cd1d5111c5555555d6655111555553351228882dc6ddcd666ddcc6c3cdc6ccdcccc6ccc33dccdcd5c55c
33551115555553355555111115111555555555555115ccd5d566c55555555dd511555551155511222222dd6dcccd6ccc6ccd36ccc333c6cdccdc56662c3dc366
15d3d15555515555555511115c3115151555555555516cc6d5553cd3c5551555115555511551111242222256dd6cccdcc3666cccccc6c6cc66cc13cdcc361c5d
555351115555515555511111d511151555555555555d6c666cc53c36d551115551115510111115222888882d3d363c5d36ccc36cccc6ccd6dc6cc355cc6d5c63
1533501155555111155515115511115dd53c5555535536cd6ccc6cccd5311155151115101111152228845dddc6cccc6ccddcddc66ccd35c5ccc9655dd3333c33
15555155555511551111111565115155cc663c1111155363c6c366cdc6d1155511535511111155ddcdd0cccd6c6cddc3cdd6dc6dd5ddddddccc315561d3631c5
1155555555511155511115053cd1d51516d563d555555553cccc633cc33115551153c51111155d3dc3cdcc663c1c3cccccd33c3dcc3cccc3ccd353c3ccf13563
1011151555551111111115115d5031d55551c3dd35555555dccc3ccdcc3d55351156d5111115ddc3c03dccc6cc6ccccc6cc3dccc6dccdc5ddcd5c55563935595
5533155555555111111111111550155d5c1111c15555555d555cd3c33cd35dcd553cd511115555d3ddcccccccccc3cccc6c36ccdcc6c6d3cd6cc5153d95cd363
553555555111151111111555553155555511155115d55555555dc5111513d36d5dc3555111155515555dc5c3ccc63ccccccccccc6cc36ccc63ccd15533535336
53553333d111515351533335555551111105511511155555555555dd155536c35cc5555155115551dcd53dcdccc36cccc69c3dccc3cdcdd3c5ccd1535311c155
55553355d101153d55335555555551111151111155555515555555531555555353d53d555111555113c35dcc3ccd3c6cd33cc3dccccdc3c3335dc553165535c1
