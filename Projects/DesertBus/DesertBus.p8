pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

-- desertbus
-- by luisfl.me
-- compiled: 24/08/20 12:45:05

-- 1_init.lua

function _init()
    palt(14, true) palt(0, false)
    sfx(0)
    mode = "intro"
    initglobal()
end

function initglobal()
    initintro()
    initgame()
end

function initintro()
    intro = {}
    intro.x = 48
    intro.y = 61
    intro.frames = 0
end

function initgame()

    -- road
    roadpointx = 55
    roadpointy = 35
    roadline = 0
    roaddebris = {}
    roaddebrisframes = 0

    -- bus
    busbounce = 0
    busbouncenext = 0.25

end

-- 2_update.lua

function _update60()
    if mode == "intro" then updateintro()
    elseif mode == "start" then updatestart()
    else updategame() end
end

function updateintro()
    if intro.frames < 59 then intro.frames += 1
    else intro.frames = 0 -- mode = "start"
        mode = "game"
    end
end

function updatestart()
    -- todo
end

function updategame()

    -- road
    if btn(0) then roadpointx += 0.5
    else roadpointx -= 0.0625 end
    roadline += 1
    if roadline > 31 then roadline = 0 end
    roaddebrisframes += 1
    if roaddebrisframes > 59 then roaddebrisframes = 0 end

    -- bus
    if busbounce > 2.05 then busbouncenext = -0.1
    elseif busbounce < -2.05 then busbouncenext = 0.1 end
    busbounce += busbouncenext

end

-- 3_updatefunctions.lua

-- updatestart

function updatestartmenu()
    -- todo
end

-- updategame

-- 4_draw.lua

function _draw()
    cls(9)
    if mode == "intro" then cls(0) drawintro()
    elseif mode == "start" then drawstart()
    else drawgame() end
end

function drawintro()
    drawbird()
    drawwordmark()
end

function drawstart()
    -- todo
end

function drawgame()

    local max = 5

    -- debris
    -- drawdebris()

    -- road
    for y = 0, 93 do
        -- brown
        line(roadpointx-y*1.6, y+35, roadpointx+y*1.6, y+35, 4)
        -- gray
        line(roadpointx-y*1.2, y+35, roadpointx+y*1.2, y+35, 5)
    end

    -- yellow lines
    for x = -1, 1 do line(roadpointx, roadpointy, ((roadpointx*2-128)+(roadpointx*max-128))/2 + x, 128, 10) end
    for y = 0 + roadline, 93, 29 do
        for y2 = -4, 4 do
            line(roadpointx + roadpointx*(y/93)-128*(y/93)+60*(y/93), y+35+y2, roadpointx + roadpointx*(max-1)*(y/93)-128*(y/93)-60*(y/93), y+35+y2, 5)
        end
    end

    -- sky
    rectfill(0, 0, 128, 35, 12)
    rectfill(0, 35, 128, 35, 6)

    -- upper part of bus
    sspr(0, 0, 128, 32, 0, 0+busbounce, 128, 32)
    rectfill(0, -8+busbounce, 128, -1+busbounce, 5)

    -- bottom part of bus
    sspr(0, 32, 128, 32, 0, 96+busbounce, 128, 32)
    rectfill(0, 128+busbounce, 128, 135+busbounce, 0)

end

function drawdebris()
    if roaddebrisframes % 10 == 0 then
        roaddebris = {}
        for x = 0, 127 do
            for y = 35, 92 do
                if rnd(10) < 0.025 then add(roaddebris, {x, y}) end
            end
        end
    end
    for dot in all(roaddebris) do
        rectfill(dot[1], dot[2], dot[1], dot[2], 4)
    end
end

-- 5_drawfunctions.lua

-- drawintro
function drawbird()
    spr(240-16*(flr(intro.frames/15)%2), intro.x, intro.y)
end

function drawwordmark()
    sspr(9, 120, 19, 5, intro.x + 9, intro.y, 19, 5)
end

-- 6_animate.lua

function animatestart()
    if start.frames > 59 then
        if start.logoy > 0.05 then start.logoy -= 0.5 * start.logoy/8 end
        if start.floory > 0.05 then start.floory -= 1 * start.floory/16
        else start.finishedanimating = true end
        if start.controlsx > 0.05 then start.controlsx -= 1.2 * start.controlsx/16 end
    end
end

__gfx__
56555555555555555555555555555555555555555555555555555555555555555555555555555555555555550000000000000000000000000000000000000000
55555555555555555655555555555555555555555555555556555555555556555555555555555555555565550111111111111111566766665111111111111111
55555555555555555555555555555556555555555555655555555555555555555555555555555555555555550555555551111111156666651111111155555555
55555555565555555555555565555555555555555555555555555555555555555555565555555565555555550111111111111111115667511111111111111111
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555550111111111115111511555115111511111111111
55555555555555500000000000000650000000000000000000000000000000000000000065000000000000550555555555551111111111111111155555555555
55556555555565500000000000000650000000000000000000000000000000000000000065000000000000550111111111111155511111115551111111111111
55555555555555500000000000000650000000000000000000000000000000000000000065000000000000550122221222222111111111111111222222122221
55555555555555500000500000000650000000000000000000000000000000000000000065000000000000000288887888887221111111111122788888788882
55555550000000000000000006666666666666666666666666666666666666666666666666600050000000000288882888888282111111111282888888288882
5550000eeeeeeee0000000000666060660060606000666006600060006060600060006666660000000000eee0222222222288288211111112882882222222222
50000eeeeeeeeee0000000000666060606060606060666060606066066060606660606606660000000000eee0288828888828288211111112882828888828882
000eeeeeeeeeeeee000000000066000606060606006666060600666066060600660066666660000000000eee0288828888728288211111112882827888828882
00eeeeeeeeeeeeee000000000006660606060606060666060606066066000606660606606600000050000eee0288828888828288821111128882828888828882
0eeeeeeeeeeeeeee000000000666000600666006060666000606060006606600060606666660000000000eee0288828888828288821111128882828888828882
0eeeeeeeeeeeeeee000000000666666666666666666666666666666666666666666666666660000000005eee0288828888822288821111128882228888828882
eeeeeeeeeeeeeeee000000050666066606060006600666666666666666666666666666666660000000005eee0222222222228288882111288882822222222222
eeeeeeeeeeeeeeee000000000666066606066066066666666666666666666666666666666660000000005eee0222222288828288882111288882828882222222
eeeeeeeeeeeeeeee500000000666066606066066000666666666666666666666666666666660000000005eee0288888728828288882111288882828827888882
eeeeeeeeeeeeeeee50000000066606660606606666066666666666666666666666666666666000000005eeee0288888828828288882111288882828828888882
eeeeeeeeeeeeeeee50000000066600066006000600666666666666666666666666666666666000000005eeee0288888828828228882111288822828828888882
eeeeeeeeeeeeeeee50000000006666666666666666666666666666666666666666666666660000000005eeee0288888828828728882111288827828828888882
eeeeeeeeeeeeeeee50000000000000000000000000000000000000000000000000000000000000000005eeee0022222228828828882111288828828822222222
eeeeeeeeeeeeeeee50000000000000000000000000000000000000000000000000000000000000000005eeeee000000000000000000030000000000000000000
eeeeeeeeeeeeeeeee555555555555555555555555555555555555555555555555555555555555555555eeeeeeeeeeeeeeeeeeeeeeeeb33eeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee33333eeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee33b33eeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee333eeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee3b33333eeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee33333eeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee3b3eeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeee8888888888888888eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeee8888888888888888888888888888eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeee88888800000000000000000000000888888eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeee888888000000000000000000000000000000008888eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeee888880000000888888888888888888888888000000008888eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeee88800000000888888888888888888888888888888880000008888eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeee888000000088888888888888888888888888888888888888000000888eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eee8880000008888888888888888888888888888888888888888888800000888eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
ee880000088888888888888888888888888888888888888888888888880000088eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
e88000888888888888888888888888888888888888888888888888888888800088eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
8000888888888888888888888888888888888888888888888888888888888800088eeeeeeee00000000000000000000000000000000000000000000000000000
00088888888888888888888888888888888888888888888888888888888888800080000000000888888888888888888888888888888888888888888888888888
08888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888880008888888888888888888888888888888888888888888888888888888888888
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01717000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99997770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700070000070000007070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00171700070000000000070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09999770070707070077077070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777770070707070070070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777770070077070770070070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00090000180551c0001c0551f0551300024051240550c000180511805518000180001c00018000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000000000
